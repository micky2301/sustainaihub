<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SustainAIHub - AI Tools for Sustainable Businesses</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        h1 { color: #228B22; text-align: center; }
        #filter { margin: 10px 0; padding: 10px; width: 200px; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #228B22; color: white; }
        tr:hover { background: #f5f5f5; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .loading { text-align: center; color: #666; }
    </style>
</head>
<body>
    <h1>SustainAIHub: AI Tools & Services for Sustainable Businesses</h1>
    <p style="text-align: center;">Discover AI solutions for eco-impact. Filter by category:</p>
    <select id="filter" onchange="filterTable()">
        <option value="">All Categories</option>
        <!-- Options will populate from data -->
    </select>
    <div id="loading" class="loading">Loading listings...</div>
    <table id="listings" style="display: none;">
        <thead><tr><th>Name</th><th>Description</th><th>Website</th><th>Category</th></tr></thead>
        <tbody></tbody>
    </table>

    <script>
        const SHEET_ID = '1IY9wqKCD6xApgXu8Ki6GMBy_zqEi-PJpzk1CR7l-mlM';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

        async function loadData() {
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) throw new Error('Sheet not public? Check sharing settings.');
                const csv = await response.text();
                const rows = csv.split('\n').map(row => row.split(',').map(cell => cell.replace(/"/g, '')));
                const headers = rows[0];
                const data = rows.slice(1).filter(row => row[0]); // Skip empty rows

                // Populate filter
                const categories = [...new Set(data.map(row => row[3]))].sort();
                const filter = document.getElementById('filter');
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    filter.appendChild(option);
                });

                // Build table
                const tbody = document.querySelector('#listings tbody');
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${row[0]}</strong></td>
                        <td>${row[1]}</td>
                        <td><a href="${row[2]}" target="_blank">${row[2]}</a></td>
                        <td>${row[3]}</td>
                    `;
                    tbody.appendChild(tr);
                });

                document.getElementById('loading').style.display = 'none';
                document.getElementById('listings').style.display = 'table';
                filterTable(); // Initial filter
            } catch (error) {
                document.getElementById('loading').textContent = `Error: ${error.message}. Fix Sheet privacy?`;
            }
        }

        function filterTable() {
            const filterValue = document.getElementById('filter').value;
            const rows = document.querySelectorAll('#listings tbody tr');
            rows.forEach(row => {
                const cat = row.cells[3].textContent;
                row.style.display = filterValue === '' || cat === filterValue ? '' : 'none';
            });
        }

        loadData();
    </script>
</body>
</html>
